{"version":3,"file":"optionstemplateselect.min.js","sources":["../src/optionstemplateselect.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AJAX helper for the inline editing a value.\n *\n * This script is automatically included from template core/inplace_editable\n * It registers a click-listener on [data-inplaceeditablelink] link (the \"inplace edit\" icon),\n * then replaces the displayed value with an input field. On \"Enter\" it sends a request\n * to web service core_update_inplace_editable, which invokes the specified callback.\n * Any exception thrown by the web service (or callback) is displayed as an error popup.\n *\n * @module     mod_booking/optionstemplateselect\n * @copyright  2019 Andraž Prinčič\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      4.5\n */\n\ndefine(['jquery', 'core/ajax'], function($, ajax) {\n\n    return {\n        init: function() {\n\n            // Put whatever you like here. $ is available\n            // to you as normal.\n            $(\"#id_optiontemplateid\").change(function() {\n                if ($(\"#id_optiontemplateid\").val() != '') {\n                    ajax\n                    .call([{\n                        methodname: 'mod_booking_optiontemplate',\n                        args: {\n                            id: $(\"#id_optiontemplateid\").val()\n                        },\n                        done: function(data) {\n                            var obj = $.parseJSON(data.template);\n\n                            // General\n                            $(\"#id_text\").val(obj.text);\n                            $(\"#id_titleprefix\").val(obj.titleprefix);\n                            $(\"#id_invisible\").val(obj.invisible);\n                            $(\"#id_annotation\").val(obj.annotation);\n                            $(\"#id_location\").val(obj.location);\n                            $(\"#id_institution\").val(obj.institution);\n                            $(\"#id_address\").val(obj.address);\n                            if ($('#id_limitanswers').is(':checked') != (obj.maxanswers == 0 ? false : true)) {\n                                $(\"#id_limitanswers\").trigger('click');\n                            }\n                            $(\"#id_maxanswers\").val(obj.maxanswers);\n                            $(\"#id_maxoverbooking\").val(obj.maxoverbooking);\n                            $(\"#id_minanswers\").val(obj.minanswers);\n\n                            if ($('#id_restrictanswerperiodopening').is(':checked') !=\n                                (obj.bookingopeningtime == 0 ? false : true)) {\n                                $(\"#id_restrictanswerperiodopening\").trigger('click');\n                            }\n\n                            if ($('#id_restrictanswerperiodclosing').is(':checked') !=\n                                (obj.bookingclosingtime == 0 ? false : true)) {\n                                $(\"#id_restrictanswerperiodclosing\").trigger('click');\n                            }\n\n                            var datebookingopeningtime = new Date(obj.bookingopeningtime * 1000);\n                            $(\"#id_bookingopeningtime_day\").val(datebookingopeningtime.getDate());\n                            $(\"#id_bookingopeningtime_month\").val(datebookingopeningtime.getMonth() + 1);\n                            $(\"#id_bookingopeningtime_year\").val(datebookingopeningtime.getFullYear());\n                            $(\"#id_bookingopeningtime_hour\").val(datebookingopeningtime.getHours());\n                            $(\"#id_bookingopeningtime_minute\").val(datebookingopeningtime.getMinutes());\n\n                            var datebookingclosingtime = new Date(obj.bookingclosingtime * 1000);\n                            $(\"#id_bookingclosingtime_day\").val(datebookingclosingtime.getDate());\n                            $(\"#id_bookingclosingtime_month\").val(datebookingclosingtime.getMonth() + 1);\n                            $(\"#id_bookingclosingtime_year\").val(datebookingclosingtime.getFullYear());\n                            $(\"#id_bookingclosingtime_hour\").val(datebookingclosingtime.getHours());\n                            $(\"#id_bookingclosingtime_minute\").val(datebookingclosingtime.getMinutes());\n\n                            $(\"#id_courseid\").val(obj.courseid);\n\n                            var x = obj.duration;\n                            switch (true) {\n                                case (x < 60):\n                                    $(\"#id_duration_number\").val(x);\n                                    $(\"#id_duration_timeunit\").val(1);\n                                    break;\n                                case (x < 3600):\n                                    $(\"#id_duration_number\").val(x / 60);\n                                    $(\"#id_duration_timeunit\").val(60);\n                                    break;\n                                case (x < 86400):\n                                    $(\"#id_duration_number\").val(x / 3600);\n                                    $(\"#id_duration_timeunit\").val(3600);\n                                    break;\n                                case (x < 604800):\n                                    $(\"#id_duration_number\").val(x / 86400);\n                                    $(\"#id_duration_timeunit\").val(86400);\n                                    break;\n                                default:\n                                    $(\"#id_duration_number\").val(x / 604800);\n                                    $(\"#id_duration_timeunit\").val(604800);\n                                    break;\n                            }\n\n                            if ($('#id_startendtimeknown').is(':checked') != (obj.coursestarttime == 0 ? false : true)) {\n                                $(\"#id_startendtimeknown\").trigger('click');\n                            }\n\n                            $(\"#id_addtocalendar\").val(obj.addtocalendar);\n\n                            var datecoursestarttime = new Date(obj.coursestarttime * 1000);\n                            $(\"#id_coursestarttime_day\").val(datecoursestarttime.getDate());\n                            $(\"#id_coursestarttime_month\").val(datecoursestarttime.getMonth() + 1);\n                            $(\"#id_coursestarttime_year\").val(datecoursestarttime.getFullYear());\n                            $(\"#id_coursestarttime_hour\").val(datecoursestarttime.getHours());\n                            $(\"#id_coursestarttime_minute\").val(datecoursestarttime.getMinutes());\n\n                            if ($('#id_enrolmentstatus').is(':checked') != (obj.enrolmentstatus == 0 ? false : true)) {\n                                $(\"#id_enrolmentstatus\").trigger('click');\n                            }\n\n                            var datecourseendtime = new Date(obj.courseendtime * 1000);\n                            $(\"#id_courseendtime_day\").val(datecourseendtime.getDate());\n                            $(\"#id_courseendtime_month\").val(datecourseendtime.getMonth() + 1);\n                            $(\"#id_courseendtime_year\").val(datecourseendtime.getFullYear());\n                            $(\"#id_courseendtime_hour\").val(datecourseendtime.getHours());\n                            $(\"#id_courseendtime_minute\").val(datecourseendtime.getMinutes());\n\n                            $(\"#id_descriptioneditable\").html(obj.description);\n                            $(\"#id_pollurl\").val(obj.pollurl);\n                            $(\"#id_pollurlteachers\").val(obj.pollurlteachers);\n                            $(\"#id_howmanyusers\").val(obj.howmanyusers);\n                            $(\"#id_removeafterminutes\").val(obj.removeafterminutes);\n\n                            // Advanced options.\n                            $(\"#id_notificationtexteditable\").html(obj.notificationtext);\n                            $(\"#id_disablebookingusers\").val(obj.disablebookingusers);\n\n                            // Booking option text depending on booking status.\n                            $(\"#id_beforebookedtexteditable\").html(obj.beforebookedtext);\n                            $(\"#id_beforecompletedtexteditable\").html(obj.beforecompletedtext);\n                            $(\"#id_aftercompletedtexteditable\").html(obj.aftercompletedtext);\n\n                            // Price formula: manual factor and absolute value.\n                            $(\"#id_priceformulamultiply\").val(obj.priceformulamultiply);\n                            $(\"#id_priceformulaadd\").val(obj.priceformulaadd);\n                            // Flag if price formula is turned on or off.\n                            $(\"#id_priceformulaoff\").val(obj.priceformulaoff);\n\n                            // Trigger clicks to fix autocomplete bugs.\n                            $(\"#fitem_id_location .form-autocomplete-downarrow\").trigger('click');\n                            $(\"#fitem_id_institution .form-autocomplete-downarrow\").trigger('click');\n                            $(\"#fitem_id_courseid .badge\").trigger('click');\n                            $(\"#id_optiontemplateid\").trigger('click');\n\n                            // A little hack to close open menus.\n                            $(\"#fitem_id_courseendtime .icon\").trigger('click');\n                            $(\"#fitem_id_courseendtime .icon\").trigger('click');\n\n                        }\n                    }], true);\n                }\n            });\n        }\n    };\n});"],"names":["define","$","ajax","init","change","val","call","methodname","args","id","done","data","obj","parseJSON","template","text","titleprefix","invisible","annotation","location","institution","address","is","maxanswers","trigger","maxoverbooking","minanswers","bookingopeningtime","bookingclosingtime","datebookingopeningtime","Date","getDate","getMonth","getFullYear","getHours","getMinutes","datebookingclosingtime","courseid","x","duration","coursestarttime","addtocalendar","datecoursestarttime","enrolmentstatus","datecourseendtime","courseendtime","html","description","pollurl","pollurlteachers","howmanyusers","removeafterminutes","notificationtext","disablebookingusers","beforebookedtext","beforecompletedtext","aftercompletedtext","priceformulamultiply","priceformulaadd","priceformulaoff"],"mappings":";;;;;;;;;;;;;;AA8BAA,2CAAO,CAAC,SAAU,cAAc,SAASC,EAAGC,YAEjC,CACHC,KAAM,WAIFF,EAAE,wBAAwBG,QAAO,WACU,IAAnCH,EAAE,wBAAwBI,OAC1BH,KACCI,KAAK,CAAC,CACHC,WAAY,6BACZC,KAAM,CACFC,GAAIR,EAAE,wBAAwBI,OAElCK,KAAM,SAASC,UACPC,IAAMX,EAAEY,UAAUF,KAAKG,UAG3Bb,EAAE,YAAYI,IAAIO,IAAIG,MACtBd,EAAE,mBAAmBI,IAAIO,IAAII,aAC7Bf,EAAE,iBAAiBI,IAAIO,IAAIK,WAC3BhB,EAAE,kBAAkBI,IAAIO,IAAIM,YAC5BjB,EAAE,gBAAgBI,IAAIO,IAAIO,UAC1BlB,EAAE,mBAAmBI,IAAIO,IAAIQ,aAC7BnB,EAAE,eAAeI,IAAIO,IAAIS,SACrBpB,EAAE,oBAAoBqB,GAAG,cAAkC,GAAlBV,IAAIW,aAC7CtB,EAAE,oBAAoBuB,QAAQ,SAElCvB,EAAE,kBAAkBI,IAAIO,IAAIW,YAC5BtB,EAAE,sBAAsBI,IAAIO,IAAIa,gBAChCxB,EAAE,kBAAkBI,IAAIO,IAAIc,YAExBzB,EAAE,mCAAmCqB,GAAG,cACb,GAA1BV,IAAIe,qBACL1B,EAAE,mCAAmCuB,QAAQ,SAG7CvB,EAAE,mCAAmCqB,GAAG,cACb,GAA1BV,IAAIgB,qBACL3B,EAAE,mCAAmCuB,QAAQ,aAG7CK,uBAAyB,IAAIC,KAA8B,IAAzBlB,IAAIe,oBAC1C1B,EAAE,8BAA8BI,IAAIwB,uBAAuBE,WAC3D9B,EAAE,gCAAgCI,IAAIwB,uBAAuBG,WAAa,GAC1E/B,EAAE,+BAA+BI,IAAIwB,uBAAuBI,eAC5DhC,EAAE,+BAA+BI,IAAIwB,uBAAuBK,YAC5DjC,EAAE,iCAAiCI,IAAIwB,uBAAuBM,kBAE1DC,uBAAyB,IAAIN,KAA8B,IAAzBlB,IAAIgB,oBAC1C3B,EAAE,8BAA8BI,IAAI+B,uBAAuBL,WAC3D9B,EAAE,gCAAgCI,IAAI+B,uBAAuBJ,WAAa,GAC1E/B,EAAE,+BAA+BI,IAAI+B,uBAAuBH,eAC5DhC,EAAE,+BAA+BI,IAAI+B,uBAAuBF,YAC5DjC,EAAE,iCAAiCI,IAAI+B,uBAAuBD,cAE9DlC,EAAE,gBAAgBI,IAAIO,IAAIyB,cAEtBC,EAAI1B,IAAI2B,iBACJ,QACED,EAAI,GACNrC,EAAE,uBAAuBI,IAAIiC,GAC7BrC,EAAE,yBAAyBI,IAAI,cAE7BiC,EAAI,KACNrC,EAAE,uBAAuBI,IAAIiC,EAAI,IACjCrC,EAAE,yBAAyBI,IAAI,eAE7BiC,EAAI,MACNrC,EAAE,uBAAuBI,IAAIiC,EAAI,MACjCrC,EAAE,yBAAyBI,IAAI,iBAE7BiC,EAAI,OACNrC,EAAE,uBAAuBI,IAAIiC,EAAI,OACjCrC,EAAE,yBAAyBI,IAAI,qBAG/BJ,EAAE,uBAAuBI,IAAIiC,EAAI,QACjCrC,EAAE,yBAAyBI,IAAI,QAInCJ,EAAE,yBAAyBqB,GAAG,cAAuC,GAAvBV,IAAI4B,kBAClDvC,EAAE,yBAAyBuB,QAAQ,SAGvCvB,EAAE,qBAAqBI,IAAIO,IAAI6B,mBAE3BC,oBAAsB,IAAIZ,KAA2B,IAAtBlB,IAAI4B,iBACvCvC,EAAE,2BAA2BI,IAAIqC,oBAAoBX,WACrD9B,EAAE,6BAA6BI,IAAIqC,oBAAoBV,WAAa,GACpE/B,EAAE,4BAA4BI,IAAIqC,oBAAoBT,eACtDhC,EAAE,4BAA4BI,IAAIqC,oBAAoBR,YACtDjC,EAAE,8BAA8BI,IAAIqC,oBAAoBP,cAEpDlC,EAAE,uBAAuBqB,GAAG,cAAuC,GAAvBV,IAAI+B,kBAChD1C,EAAE,uBAAuBuB,QAAQ,aAGjCoB,kBAAoB,IAAId,KAAyB,IAApBlB,IAAIiC,eACrC5C,EAAE,yBAAyBI,IAAIuC,kBAAkBb,WACjD9B,EAAE,2BAA2BI,IAAIuC,kBAAkBZ,WAAa,GAChE/B,EAAE,0BAA0BI,IAAIuC,kBAAkBX,eAClDhC,EAAE,0BAA0BI,IAAIuC,kBAAkBV,YAClDjC,EAAE,4BAA4BI,IAAIuC,kBAAkBT,cAEpDlC,EAAE,2BAA2B6C,KAAKlC,IAAImC,aACtC9C,EAAE,eAAeI,IAAIO,IAAIoC,SACzB/C,EAAE,uBAAuBI,IAAIO,IAAIqC,iBACjChD,EAAE,oBAAoBI,IAAIO,IAAIsC,cAC9BjD,EAAE,0BAA0BI,IAAIO,IAAIuC,oBAGpClD,EAAE,gCAAgC6C,KAAKlC,IAAIwC,kBAC3CnD,EAAE,2BAA2BI,IAAIO,IAAIyC,qBAGrCpD,EAAE,gCAAgC6C,KAAKlC,IAAI0C,kBAC3CrD,EAAE,mCAAmC6C,KAAKlC,IAAI2C,qBAC9CtD,EAAE,kCAAkC6C,KAAKlC,IAAI4C,oBAG7CvD,EAAE,4BAA4BI,IAAIO,IAAI6C,sBACtCxD,EAAE,uBAAuBI,IAAIO,IAAI8C,iBAEjCzD,EAAE,uBAAuBI,IAAIO,IAAI+C,iBAGjC1D,EAAE,mDAAmDuB,QAAQ,SAC7DvB,EAAE,sDAAsDuB,QAAQ,SAChEvB,EAAE,6BAA6BuB,QAAQ,SACvCvB,EAAE,wBAAwBuB,QAAQ,SAGlCvB,EAAE,iCAAiCuB,QAAQ,SAC3CvB,EAAE,iCAAiCuB,QAAQ,aAG/C"}